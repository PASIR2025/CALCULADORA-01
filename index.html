<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Protecciones para Motor Trif√°sico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registrado ‚úÖ'))
        .catch(error => console.log('Service Worker error:', error));
    }
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    /* üåû Modo Claro */
    body.light {
      background-color: #ffffff;
      color: #000000;
    }
    body.light .resultado {
      background-color: #f5f5f5;
      border: 1px solid #0077cc;
    }
    body.light .etiqueta-itm {
      color: #0055aa;
    }

    /* üåô Modo Oscuro */
    body.dark {
      background-color: #1e1e1e;
      color: #f1f1f1;
    }
    body.dark .resultado {
      background-color: #333;
      border: 1px solid #66cccc;
    }
    body.dark .etiqueta-itm {
      color: #99ccff;
    }

    .contenedor {
      max-width: 450px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    h2 {
      font-size: 1.4em;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #66b3ff;
    }
    h2 img {
      width: 40px;
    }
    label, input, select {
      display: block;
      margin-top: 10px;
      width: 100%;
    }
    input, select, button {
      padding: 8px;
      font-size: 1em;
    }
    .info-unidad {
      font-size: 0.85em;
      color: gray;
      margin-top: 4px;
    }
    .botones {
      margin-top: 20px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .botones button {
      flex: 1;
      min-width: 150px;
    }
    .resultado {
      margin-top: 30px;
      padding: 15px;
      border-radius: 5px;
    }
    .proteccion {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }
    .proteccion img {
      width: 60px;
      margin-right: 15px;
    }
    .opcional {
      font-size: 0.8em;
      font-style: italic;
    }
    .etiqueta-itm {
      font-size: 0.8em;
      margin-top: 5px;
    }
    .modo-btn {
      margin: 15px 0;
      padding: 8px 15px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .mensaje-error {
      color: #f97373;
      font-size: 0.85em;
      margin-top: 8px;
    }
    .nota-supuestos {
      font-size: 0.75em;
      margin-top: 10px;
      opacity: 0.8;
    }
  </style>
</head>
<body class="dark"><!-- Inicia en modo oscuro -->

  <div class="contenedor">
    <button class="modo-btn" onclick="toggleModo()">üåû/üåô Cambiar modo</button>

    <h2>
      <img src="imagenes/logo.png" alt="Logo">
      <span>
             DIMENSIONAMIENTO<br>
          DE DISPOSITIVOS PARA<br>
        ARRANQUE DE MOTOR TRIF√ÅSICO
      </span>
    </h2>

    <label for="potenciaHp">Potencia del motor (HP):</label>
    <input type="number" id="potenciaHp" step="0.01" placeholder="Ej: 7.5" oninput="hpToKw()">
    <div class="info-unidad">Conversi√≥n autom√°tica a kW.</div>

    <label for="potenciaKw" style="margin-top:20px;">Potencia del motor (kW):</label>
    <input type="number" id="potenciaKw" step="0.01" placeholder="Ej: 5.6" oninput="kwToHp()">
    <div class="info-unidad">Conversi√≥n autom√°tica a HP.</div>

    <label for="voltaje">Tensi√≥n trif√°sica (V):</label>
    <select id="voltaje">
      <option value="220">220 V</option>
      <option value="380" selected>380 V</option>
      <option value="440">440 V</option>
    </select>

    <label for="eficiencia">Eficiencia estimada (Œ∑):</label>
    <input type="number" id="eficiencia" value="0.90" min="0.5" max="1" step="0.01">

    <label for="fp">Factor de potencia (cos œÜ):</label>
    <input type="number" id="fp" value="0.85" min="0.1" max="1" step="0.01">

    <label for="arranque">Tipo de arranque:</label>
    <select id="arranque">
      <option value="1">Directo</option>
      <option value="estrella">Estrella-tri√°ngulo</option>
      <option value="0.7">Arrancador suave</option>
      <option value="vfd">Variador de frecuencia (VFD)</option>
    </select>

    <div class="botones">
      <button onclick="calcular()">Calcular</button>
      <button onclick="window.print()">üñ® Imprimir / Guardar PDF</button>
    </div>

    <div id="resultado" class="resultado" style="display:none;"></div>
  </div>

  <script>
    const HP_TO_KW = 0.746;

    function toggleModo() {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
    }

    function hpToKw() {
      const hp = parseFloat(document.getElementById("potenciaHp").value);
      if (!isNaN(hp)) {
        document.getElementById("potenciaKw").value = (hp * HP_TO_KW).toFixed(2);
      }
    }

    function kwToHp() {
      const kw = parseFloat(document.getElementById("potenciaKw").value);
      if (!isNaN(kw)) {
        document.getElementById("potenciaHp").value = (kw / HP_TO_KW).toFixed(2);
      }
    }

    // Sugerencia de ITM comercial
    function seleccionarITMcomercial(corriente) {
      const valores = [6, 10, 16, 20, 25, 32, 40, 50, 63, 80, 100, 125, 160, 200];
      for (let i = 0; i < valores.length; i++) {
        if (corriente <= valores[i]) {
          return valores[i];
        }
      }
      return valores[valores.length - 1];
    }

    function calcular() {
      const potenciaKw = parseFloat(document.getElementById("potenciaKw").value);
      const voltaje = parseFloat(document.getElementById("voltaje").value);
      const eficiencia = parseFloat(document.getElementById("eficiencia").value);
      const fp = parseFloat(document.getElementById("fp").value);
      const arranque = document.getElementById("arranque").value;

      const resultadoDiv = document.getElementById("resultado");
      let errores = [];

      if (isNaN(potenciaKw) || potenciaKw <= 0) {
        errores.push("Ingresa una potencia v√°lida en kW (mayor que 0).");
      }
      if (isNaN(voltaje) || voltaje <= 0) {
        errores.push("Selecciona una tensi√≥n trif√°sica v√°lida.");
      }
      if (isNaN(eficiencia) || eficiencia <= 0 || eficiencia > 1) {
        errores.push("La eficiencia (Œ∑) debe estar entre 0 y 1 (ej. 0.90).");
      }
      if (isNaN(fp) || fp <= 0 || fp > 1) {
        errores.push("El factor de potencia (cos œÜ) debe estar entre 0 y 1 (ej. 0.85).");
      }

      if (errores.length > 0) {
        resultadoDiv.style.display = "block";
        resultadoDiv.innerHTML = `
          <strong>‚ö† Corrige los siguientes puntos:</strong>
          <ul>${errores.map(e => `<li>${e}</li>`).join("")}</ul>
        `;
        return;
      }

      const In = (potenciaKw * 1000) / (Math.sqrt(3) * voltaje * fp * eficiencia);
      let intensidadOperacion = In;

      if (arranque === "0.7") intensidadOperacion *= 0.7;
      else if (arranque === "estrella") intensidadOperacion *= 0.58;

      const contactorMin = (intensidadOperacion * 1.15).toFixed(1);
      const contactorMax = (intensidadOperacion * 1.25).toFixed(1);
      const releMin = (intensidadOperacion * 1.05).toFixed(1);
      const releMax = (intensidadOperacion * 1.15).toFixed(1);
      const itmMin = Math.ceil(In * 1.25);
      const itmMax = Math.ceil(In * 1.5);
      const itmComercial = seleccionarITMcomercial(itmMax);
      const corrienteEstrella = (In * 0.33).toFixed(1);

      let curvaTexto = "Curva C recomendada para motores.";
      if (arranque === "vfd" || arranque === "estrella") {
        curvaTexto = "Curva C o D recomendada seg√∫n tipo de arranque y condiciones de servicio.";
      }

      let resultadoHTML = `
        <strong>‚öô Resultados para motor de ${potenciaKw.toFixed(2)} kW (${(potenciaKw / HP_TO_KW).toFixed(2)} HP) a ${voltaje} V</strong><br>
        <strong>Corriente estimada (In):</strong> ${In.toFixed(2)} A
        <div class="nota-supuestos">
          Supuestos: sistema trif√°sico, c√°lculo seg√∫n P = ‚àö3¬∑V¬∑I¬∑cos œÜ¬∑Œ∑. Valores orientativos para fines did√°cticos.
        </div>
        <hr>
      `;

      if (arranque === "vfd") {
        resultadoHTML += `
          <div class="proteccion">
            <img src="imagenes/itm.png" alt="ITM">
            <div>
              <strong>ITM:</strong> ${itmMin} A - ${itmMax} A<br>
              <strong>ITM comercial sugerido:</strong> ${itmComercial} A<br>
              <div class="etiqueta-itm">
                üìò Calculado al 125%-150% de In seg√∫n IEC 60947-2 y CNE Per√∫ Secci√≥n 4.3.2<br>
                ${curvaTexto}
              </div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/diferencial.png" alt="Interruptor diferencial">
            <div><strong>Interruptor diferencial:</strong> Igual o superior a ${itmComercial} A</div>
          </div>
          <div class="proteccion">
            <img src="imagenes/contactor.png" alt="Contactor">
            <div><strong>Contactor:</strong> ${contactorMin} A - ${contactorMax} A <span class="opcional">(opcional seg√∫n esquema con VFD)</span></div>
          </div>
        `;
      } else if (arranque === "estrella") {
        resultadoHTML += `
          <div class="proteccion">
            <img src="imagenes/itm.png" alt="ITM" />
            <div>
              <strong>ITM:</strong> ${itmMin} A - ${itmMax} A<br>
              <strong>ITM comercial sugerido:</strong> ${itmComercial} A
              <div class="etiqueta-itm">
                üìò Calculado al 125%-150% de In seg√∫n IEC 60947-2 y CNE Per√∫ Secci√≥n 4.3.2<br>
                ${curvaTexto}
              </div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/contactor.png" alt="Contactor" />
            <div>
              <strong>Contactores:</strong><br>
              Principal y Tri√°ngulo (Œî): ${contactorMin} A - ${contactorMax} A<br>
              Estrella (Y): ${(In * 0.33 * 1.15).toFixed(1)} A - ${(In * 0.33 * 1.25).toFixed(1)} A<br>
              <span class="etiqueta-itm">üìò En estrella la corriente ‚âà 33% de la corriente nominal.</span>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/rele.png" alt="Rel√© t√©rmico" />
            <div><strong>Rel√© t√©rmico:</strong> ${releMin} A - ${releMax} A</div>
          </div>
        `;
      } else {
        resultadoHTML += `
          <div class="proteccion">
            <img src="imagenes/itm.png" alt="ITM" />
            <div>
              <strong>ITM:</strong> ${itmMin} A - ${itmMax} A<br>
              <strong>ITM comercial sugerido:</strong> ${itmComercial} A
              <div class="etiqueta-itm">
                üìò Calculado al 125%-150% de In seg√∫n IEC 60947-2 y CNE Per√∫ Secci√≥n 4.3.2<br>
                ${curvaTexto}
              </div>
            </div>
          </div>
          <div class="proteccion">
            <img src="imagenes/contactor.png" alt="Contactor" />
            <div><strong>Contactor:</strong> ${contactorMin} A - ${contactorMax} A</div>
          </div>
          <div class="proteccion">
            <img src="imagenes/rele.png" alt="Rel√© t√©rmico" />
            <div><strong>Rel√© t√©rmico:</strong> ${releMin} A - ${releMax} A</div>
          </div>
        `;
      }

      resultadoHTML += `
        <div class="proteccion">
          <img src="imagenes/motor.png" alt="Motor" />
          <div><strong>Motor:</strong> ${potenciaKw.toFixed(2)} kW (${(potenciaKw / HP_TO_KW).toFixed(2)} HP), In: ${In.toFixed(2)} A</div>
        </div>
      `;

      resultadoDiv.innerHTML = resultadoHTML;
      resultadoDiv.style.display = "block";
    }
  </script>
</body>
</html>
